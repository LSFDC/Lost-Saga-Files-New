

#ifndef _ioSP2TCPSocket_h_
#define _ioSP2TCPSocket_h_

#define WM_TCPSOCKET1  (WM_USER + 100)
#define WM_TCPSOCKET2  (WM_USER + 101)
#define WM_TCPSOCKET3  (WM_USER + 102)
#define WM_TCPSOCKET4  (WM_USER + 103)
#define WM_TCPSOCKET5  (WM_USER + 104)
#define WM_TCPSOCKET6  (WM_USER + 105)
#define WM_TCPSOCKET7  (WM_USER + 106)
#define WM_TCPSOCKET8  (WM_USER + 107)
#define WM_TCPSOCKET9  (WM_USER + 108)
#define WM_TCPSOCKET10 (WM_USER + 109)
#define WM_TCPSOCKET11 (WM_USER + 110)
#define WM_TCPSOCKET12 (WM_USER + 111)
#define WM_TCPSOCKET13 (WM_USER + 112)
#define WM_TCPSOCKET14 (WM_USER + 113)
#define WM_TCPSOCKET15 (WM_USER + 114)
#define WM_TCPSOCKET16 (WM_USER + 115)
#define WM_TCPSOCKET17 (WM_USER + 116)
#define WM_TCPSOCKET18 (WM_USER + 117)
#define WM_TCPSOCKET19 (WM_USER + 118)
#define WM_TCPSOCKET20 (WM_USER + 119)
#define WM_TCPSOCKET21 (WM_USER + 120)
#define WM_TCPSOCKET22 (WM_USER + 121)
#define WM_TCPSOCKET23 (WM_USER + 122)
#define WM_TCPSOCKET24 (WM_USER + 123)
#define WM_TCPSOCKET25 (WM_USER + 124)
#define WM_TCPSOCKET26 (WM_USER + 125)
#define WM_TCPSOCKET27 (WM_USER + 126)
#define WM_TCPSOCKET28 (WM_USER + 127)
#define WM_TCPSOCKET29 (WM_USER + 128)
#define WM_TCPSOCKET30 (WM_USER + 129)
#define WM_TCPSOCKET31 (WM_USER + 130)
#define WM_TCPSOCKET32 (WM_USER + 131)
#define WM_TCPSOCKET33 (WM_USER + 132)
#define WM_TCPSOCKET34 (WM_USER + 133)
#define WM_TCPSOCKET35 (WM_USER + 134)
#define WM_TCPSOCKET36 (WM_USER + 135)
#define WM_TCPSOCKET37 (WM_USER + 136)
#define WM_TCPSOCKET38 (WM_USER + 137)
#define WM_TCPSOCKET39 (WM_USER + 138)
#define WM_TCPSOCKET40 (WM_USER + 139)
#define WM_TCPSOCKET41 (WM_USER + 140)
#define WM_TCPSOCKET42 (WM_USER + 141)
#define WM_TCPSOCKET43 (WM_USER + 142)
#define WM_TCPSOCKET44 (WM_USER + 143)
#define WM_TCPSOCKET45 (WM_USER + 144)
#define WM_TCPSOCKET46 (WM_USER + 145)
#define WM_TCPSOCKET47 (WM_USER + 146)
#define WM_TCPSOCKET48 (WM_USER + 147)
#define WM_TCPSOCKET49 (WM_USER + 148)
#define WM_TCPSOCKET50 (WM_USER + 149)
#define WM_TCPSOCKET51 (WM_USER + 150)
#define WM_TCPSOCKET52 (WM_USER + 151)
#define WM_TCPSOCKET53 (WM_USER + 152)
#define WM_TCPSOCKET54 (WM_USER + 153)
#define WM_TCPSOCKET55 (WM_USER + 154)
#define WM_TCPSOCKET56 (WM_USER + 155)
#define WM_TCPSOCKET57 (WM_USER + 156)
#define WM_TCPSOCKET58 (WM_USER + 157)
#define WM_TCPSOCKET59 (WM_USER + 158)
#define WM_TCPSOCKET60 (WM_USER + 159)
#define WM_TCPSOCKET61 (WM_USER + 160)
#define WM_TCPSOCKET62 (WM_USER + 161)
#define WM_TCPSOCKET63 (WM_USER + 162)
#define WM_TCPSOCKET64 (WM_USER + 163)
#define WM_TCPSOCKET65 (WM_USER + 164)
#define WM_TCPSOCKET66 (WM_USER + 165)
#define WM_TCPSOCKET67 (WM_USER + 166)
#define WM_TCPSOCKET68 (WM_USER + 167)
#define WM_TCPSOCKET69 (WM_USER + 168)
#define WM_TCPSOCKET70 (WM_USER + 169)
#define WM_TCPSOCKET71 (WM_USER + 170)
#define WM_TCPSOCKET72 (WM_USER + 171)
#define WM_TCPSOCKET73 (WM_USER + 172)
#define WM_TCPSOCKET74 (WM_USER + 173)
#define WM_TCPSOCKET75 (WM_USER + 174)
#define WM_TCPSOCKET76 (WM_USER + 175)
#define WM_TCPSOCKET77 (WM_USER + 176)
#define WM_TCPSOCKET78 (WM_USER + 177)
#define WM_TCPSOCKET79 (WM_USER + 178)
#define WM_TCPSOCKET80 (WM_USER + 179)
#define WM_TCPSOCKET81 (WM_USER + 180)
#define WM_TCPSOCKET82 (WM_USER + 181)
#define WM_TCPSOCKET83 (WM_USER + 182)
#define WM_TCPSOCKET84 (WM_USER + 183)
#define WM_TCPSOCKET85 (WM_USER + 184)
#define WM_TCPSOCKET86 (WM_USER + 185)
#define WM_TCPSOCKET87 (WM_USER + 186)
#define WM_TCPSOCKET88 (WM_USER + 187)
#define WM_TCPSOCKET89 (WM_USER + 188)
#define WM_TCPSOCKET90 (WM_USER + 189)
#define WM_TCPSOCKET91 (WM_USER + 190)
#define WM_TCPSOCKET92 (WM_USER + 191)
#define WM_TCPSOCKET93 (WM_USER + 192)
#define WM_TCPSOCKET94 (WM_USER + 193)
#define WM_TCPSOCKET95 (WM_USER + 194)
#define WM_TCPSOCKET96 (WM_USER + 195)
#define WM_TCPSOCKET97 (WM_USER + 196)
#define WM_TCPSOCKET98 (WM_USER + 197)
#define WM_TCPSOCKET99 (WM_USER + 198)
#define WM_TCPSOCKET100 (WM_USER + 199)

enum TCPLOGIN
{
	WM_TCPLOGIN1 = WM_TCPSOCKET90,
	WM_TCPLOGIN2,
	WM_TCPLOGIN3,
	WM_TCPLOGIN4,
	WM_TCPLOGIN5,
	WM_TCPLOGIN6,
	WM_TCPLOGIN8,
	WM_TCPLOGIN9,
	WM_TCPLOGIN10,
	WM_TCPLOGIN11,


};
 


#define RIGHT_MSG_CHECK_VALUE "8302kdlso209f&3%#!%&&f"

class ioSP2TCPSocket : public ioClientTCPSocket
{
public:
	virtual void ConnectProcess();
	virtual void DisconnectProcess();
	virtual void ProcessPacket( CPacket &rkPacket );
	virtual bool CheckNS( CPacket &rkPacket );
	UINT GetWndMsg() {return m_WndMsg;};

public:
	void InitState();

public:
	ioSP2TCPSocket();
	virtual ~ioSP2TCPSocket();
};
//////////////////////////////////////////////////////////////////////////
class FSM;
class ioTCPClientSecurity : public NetworkSecurity
{
	FSM m_SndState;
	FSM m_RcvState;

public:
	void InitState();

	// Packet CheckSum
protected:	
	void  EncryptMsg( CPacket &rkPacket );
	void  DecryptMsg( CPacket &rkPacket );
public:
	virtual bool IsCheckSum( CPacket &rkPacket );

	// Packet Replay
public:
	virtual int	 GetSndState();
	virtual void UpdateSndState();
	virtual int  GetRcvState();
	virtual void UpdateRcvState();
	virtual bool CheckState( CPacket &rkPacket );

	// Send 
public:
	virtual void PrepareMsg( CPacket &rkPacket );
	virtual void CompletionMsg( CPacket &rkPacket );

public:
	ioTCPClientSecurity();
	virtual ~ioTCPClientSecurity();
};
#endif